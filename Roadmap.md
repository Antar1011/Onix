# Development Roadmap

This document lays out my plans for the development of Onix. It is far from set
in stone (which is why I'm putting it in GitHub as opposed to the blog), but it
will be a useful resource for me to keep myself on track towards a clear
end-goal. To that end, before laying out the roadmap itself, I'm starting with
the "destination," the state I envision for Onix in its "1.0" release. Only
after the description of this "final" state do I proceed to lay out how I plan
on getting there.

## 1.0
At this point, Onix will be considered fully usable, and a system built on Onix
will officially replace the
[Smogon-Usage-Stats](https://github.com/Antar1011/Smogon-Usage-Stats) scripts in
 "production." This release must meet the following requirements:
 - Replicates or replaces the full suite of analyses present in the existing
  Smogon Usage Stats, namely:
  - Usage statistics / rankings
  - Detailed moveset statistics
   - Including checks / counters and teammate stats
  - Metagame analyses
  - Lead Stats
  - Detailed monotype statistics
 - Supports the following new analyses, not present in the current Smogon
  Usage Stats suite
  - Lead and check / counter stats for Doubles / Triples tiers
  - Support for non-standard metagames
   - Previous generations
   - Seasonal tiers
  - Move usage statistics
 - Supports performing ratings validation
 - Supports analysis-time rating calculations and alternative rating and
  weighting systems
 - Supports updating and re-analyzing historical data (_e.g._ new team type)
  without having to go back to the logs
 - Supports a public API for deep queries (_e.g._ "What fraction of Serperior
  with ability Contrary run Leaf Storm?" and "What's the most common Pokemon on
  teams with both Landorus and Charizard-Mega-X?")
 - Supports researcher access to anonymized data sources (that is, backed by
  a database that provides fine-grain access control)
 - Performance-optimized
 - Handles errors in an intelligent way (_e.g._ species not found in Pokedex?
  Try updating the Pokedex!)
 - Deploys in "production" environment (might share a server with Pokemon
  Showdown or Smogon or might be hosted on a separate server or AWS)
  - Installable via pip, possibly with non-Python dependences (_e.g._ node.js,
    a postgresql server or, well, pip, but not anaconda)
  - Works with system-default Python 2 or 3 (newer Ubuntus)
   - PyPy would be nice

## Intermediate Milestones
To get to this point, I've charted out a rough map of the milestones I expect
to meet along the way. At the point of every release, Onix must pass all tests
(which must maintain as close to 100% coverage as possible and cover every
edge-case I can think of) and have complete documentation. As development
proceeds past a release, patches and bugfixes will be applied as deemed
appropriate.

### 0.1
"Proof of Concept" release with a complete functioning pipeline from logs to
stat reports for the most essential of analyses. This release must meet the
following requirements: 
  - Can produce usage statistics / rankings report for all non-mod tiers (so,
  yes Hackmons, no Gen V UU)
  - Collection system supports extraction of movesets and battle info
    - Processing the turn-by-turn battle logs not required at this point
  - Must work on Python 2.7, 3.5 (PyPy not required)
      
### 0.2
This release will build out more of the reporting infrastructure in a robust
way, potentially making use of concurrency. It must meet the following
requirements:
  - Can produce detiled moveset statistics, _sans_ checks & counters and
  anything that requires "enrichment" (_e.g._ stalliness metrics)
  - Reporting system can handle producing multiple reports simultaenously
    - If the database is Sqlite, will have to research whether it supports
    concurrent access. If it doesn't, the database will have to be sharded.
    
### 0.3
This release focuses on processing the turn-by-turn battle logs, which is going
to be a huge project. The release must meet the following requirements:
  - Collection system supports processing of turn-by-turn battle logs
    - Must include doubles / triples as well as singles
    - Don't need to be in the same DB infrastructure as the rest of the system
    (that is, no requirement for JSON storage in SQLite)
  - The first "enrichment" processes will be in this release to support the
  following analyses using data taken from the turn-by-turn logs:
   - Lead statistics (for doubles / triples as well as singles)
   - "Turn out" statistics (avg. # of turns on the field per Pokemon or
    moveset)

### 0.4
"MVP" release, which builds "enrichment" processes to allow for the production
of all reports generated by the current Smogon Usage Stats suite. This release
must meet the following requirements:
  - Supports the following additional analyses:
    - Checks & Counters statistics (Singles only)
    - Teammate statistics
    - Stalliness analysis
    - Team tagging / metagame analysis
    - "Viability ceiling" metric
  - Easily deployable on Pokemon Showdown server
    - This could require installing miniconda and running in a virtual
    environment
    - Really, the focus here is no conflict with existing infrastrucute (_e.g._
    Onix doesn't require a DB that conflicts with PS' DBs)
      - But again, this should be the advantage of using virtual environments
  - Stable enough to get through a full month of logs (with "problematic" 
  metagames skipped)
  - Performance target (setting the bar really low):
    - 10 days to process 30 days of logs (collection)
    - 5 days to enrich and produce reports

### 0.5
This release focuses on setting up a robust and scalable database backend. It
must meet the following requirements:
  - Uses a database backend that:
    - Scales to meet our needs (can hold complete processed logs for 3 months of
    data while still executing queries efficiently)
    - Allows for fine-grained access control (allow certain users to access 
    some tables but not others)
    - Can store JSON documents (turn-by-turn battle logs)
      - Querying on contents is not a requirement, so this could really just be
      a binary / text store
      - Document storage could also be in a separate DB, but the preference is
      for one unified DB solution

### 0.6
This release focuses on "tech debt" elimination, the handling of edge cases and
"problematic" metagames, and support for alternative methods of stats counting.
It must meet the following requirements:
  - All existing analyses must be supported across all metagames
    - Including extending Check/Counter analyses to non-singles metagames
    - Including support for "mod" metagames (previous gens, etc.)
  - Support for manual player Glicko rating calculations, manual _team_ Glicko
  rating calculations (and combined variants)
   - Support for using these caclulations to weight stats
  - Support for rating system validation analyses 
  - Support for alternative weighting systems (_e.g._ old Pokemon Online-style
  simple "1337" Elo thresholding or simply using the "latest rating" to weight
  all occurrences for a player / team)
  
### 0.7
This release will incorporate new analyses and features that were not possible
for the old Smogon Usage Stats scripts. No new features will be allowed after
this release (feature freeze). Which analyses will be added will be based on
community feedback. As such, there is no strong requirements list. However, I
expect this release to incorporate the following:
  - A REST API with a separate database back-end to support "deep queries." It
  will have built-in privacy safe-guards (no results if the number of battles
  matching the query was less than, say, 100)
  - Move analysis (move frequencies, most common users, move success rates...)
  - Historical analyses and redoing analyses without having to go
  back to the logs
  - Robust error-handling
    - Automated attempts at error resolution (_e.g._ re-scrape the Pokedex if
    a species is not found)
    - Heuristics for determining when to simply skip logs and go on and when to
    terminate and wait for a bugfix
    - Gathering of problematic logs to help create test cases
  
### Feature Freeze
No new functionality will be added after this point

### 0.8
This release will focus on compatibility and portability. The main goal will be
to make Onix compatible with PyPy, but this will also focus on removing
any dependencies which are not absolutely necessary and making sure Onix
installs and runs in any conceivable production environment (to include the 
Pokemon Showdown and Smogon servers and an AWS AMI). Reliance on virtual
environments (conda or virtualenv) will be heavily discouraged. There are no
hard-and-fast requirements for this release; it will be considered complete when
I feel there is no room for additional improvements.

### 0.9
This release will focus on performance optimizations. I will do detailed
profiling to determine where the "pain points" are when processing logs and
generating reports and doing optimizations to increase performance. Performance
will be prioritized over compatibility (so if it's more performant to use ujson
and numba, say, than to keep compatibility with PyPy, I'll ditch PyPy).

### 1.0
After all of that, Onix will reach 1.0 when it is performing as expected,
validated against the existing Smogon Usage Stats and is ready to be deployed
into "production".
 
  
  


 
